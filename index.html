<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Formula 1 Racing</title>

  <!-- MOBILE OPTIMIZATION -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      user-select: none;
    }

    #score {
      font-size: 20px;
      margin: 10px;
    }

    #game {
      width: 90vw;
      max-width: 360px;
      height: 70vh;
      max-height: 600px;
      margin: auto;
      background: #444;
      position: relative;
      overflow: hidden;
      border: 3px solid white;
      touch-action: none;
    }

    /* ROAD LINES (VISUAL ONLY) */
    .road-line {
      width: 6px;
      height: 80px;
      background: white;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0.8;
    }

    /* PLAYER */
    #player {
      width: 60px;
      height: 100px;
      position: absolute;
      bottom: 20px;
      left: 150px;
      pointer-events: none;
    }

    /* ENEMIES */
    .enemy {
      width: 60px;
      height: 100px;
      position: absolute;
      top: -120px;
      object-fit: contain;
      pointer-events: none;
    }

    .controls {
      margin-top: 10px;
    }

    button {
      font-size: 22px;
      padding: 14px 30px;
      margin: 10px;
      border-radius: 10px;
      border: none;
    }
  </style>
</head>

<body>

<div id="score">Score: 0</div>

<div id="game">
  <div class="road-line"></div>
  <div class="road-line"></div>
  <div class="road-line"></div>

  <img id="player" src="player.png">

  <img class="enemy">
  <img class="enemy">
  <img class="enemy">
  <img class="enemy">
</div>

<div class="controls">
  <button id="leftBtn">? LEFT</button>
  <button id="rightBtn">RIGHT ?</button>
</div>

<!-- ?? SOUND EFFECTS -->
<audio id="engine" loop>
  <source src="https://actions.google.com/sounds/v1/transportation/car_engine.ogg">
</audio>

<audio id="crash">
  <source src="https://actions.google.com/sounds/v1/impacts/crash.ogg">
</audio>

<audio id="click">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg">
</audio>

<script>
  const game = document.getElementById("game");
  const player = document.getElementById("player");
  const enemies = document.querySelectorAll(".enemy");
  const lines = document.querySelectorAll(".road-line");
  const scoreText = document.getElementById("score");

  const engineSound = document.getElementById("engine");
  const crashSound = document.getElementById("crash");
  const clickSound = document.getElementById("click");

  let playerX = 150;
  let speed = 4;
  let score = 0;
  let running = true;

  const moveStep = 12;
  const hitboxPadding = 15;

  const enemyImages = [
    "enemy1.png",
    "enemy2.png",
    "enemy3.png",
    "enemy4.png"
  ];

  let enemyData = [];

  enemies.forEach((enemy, i) => {
    enemy.src = enemyImages[i];
    enemyData.push({
      el: enemy,
      x: Math.random() * 300,
      y: -150 * (i + 1)
    });
  });

  let lineY = [0, 200, 400];
  lines.forEach((line, i) => line.style.top = lineY[i] + "px");

  function updatePlayer() {
    player.style.left = playerX + "px";
  }

  function moveLines() {
    lines.forEach((line, i) => {
      lineY[i] += speed;
      if (lineY[i] > game.clientHeight) lineY[i] = -80;
      line.style.top = lineY[i] + "px";
    });
  }

  function moveEnemies() {
    enemyData.forEach(e => {
      e.y += speed;
      e.el.style.top = e.y + "px";
      e.el.style.left = e.x + "px";

      if (e.y > game.clientHeight) {
        e.y = -120;
        e.x = Math.random() * (game.clientWidth - 60);
        e.el.src = enemyImages[Math.floor(Math.random() * enemyImages.length)];
        score += 10;
        scoreText.textContent = "Score: " + score;
      }
    });
  }

  function checkCollision() {
    const p = player.getBoundingClientRect();

    enemyData.forEach(e => {
      const r = e.el.getBoundingClientRect();

      if (
        p.left + hitboxPadding < r.right - hitboxPadding &&
        p.right - hitboxPadding > r.left + hitboxPadding &&
        p.top + hitboxPadding < r.bottom - hitboxPadding &&
        p.bottom - hitboxPadding > r.top + hitboxPadding
      ) {
        endGame();
      }
    });
  }

  function endGame() {
    running = false;
    engineSound.pause();
    crashSound.play();
    setTimeout(() => {
      alert("Game Over! Score: " + score);
      location.reload();
    }, 200);
  }

  function gameLoop() {
    if (!running) return;
    moveLines();
    moveEnemies();
    checkCollision();
    requestAnimationFrame(gameLoop);
  }

  /* START SOUND AFTER USER INTERACTION (MOBILE RULE) */
  document.addEventListener("click", () => {
    engineSound.volume = 0.4;
    engineSound.play();
  }, { once: true });

  gameLoop();

  /* KEYBOARD */
  document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft") playerX -= moveStep;
    if (e.key === "ArrowRight") playerX += moveStep;

    playerX = Math.max(0, Math.min(game.clientWidth - player.offsetWidth, playerX));
    updatePlayer();
  });

  /* BUTTONS */
  leftBtn.onclick = () => {
    clickSound.play();
    playerX -= moveStep;
    playerX = Math.max(0, playerX);
    updatePlayer();
  };

  rightBtn.onclick = () => {
    clickSound.play();
    playerX += moveStep;
    playerX = Math.min(game.clientWidth - player.offsetWidth, playerX);
    updatePlayer();
  };

  /* SWIPE */
  let startX = null;

  game.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
  });

  game.addEventListener("touchmove", e => {
    if (!startX) return;
    let diff = e.touches[0].clientX - startX;

    if (diff > 30) playerX += moveStep;
    if (diff < -30) playerX -= moveStep;

    playerX = Math.max(0, Math.min(game.clientWidth - player.offsetWidth, playerX));
    updatePlayer();
    startX = null;
  });
</script>

</body>
</html>